const translations = {
    "en": {
        "nav.performance": "Performance",
        "nav.architecture": "Tech Specs",
        "nav.features": "Features",
        "cta.download": "Download v3.0.4",
        "cta.github": "View Source",
        "hero.title": "The Fastest Image Viewer<br>for Windows.",
        "hero.subtitle": "A professional-grade image viewer focused purely on speed. Open source, yet rivals top-tier commercial software.<br>Renowned for its lightweight footprint, instant response, and comprehensive format support. Built for designers and photographers.",

        "arch.title": "Core Engine: Quantum Flow",
        "arch.desc": "Unlike traditional viewers that freeze when loading large files, QuickView uses <span class='text-blue'>Anti-Freeze Technology</span> to keep the interface responsive.",

        "feat.matrix": "01. Performance Monitor",
        "feat.matrix.desc": "Press <strong class='text-primary'>F12</strong> to see real-time computer resource usage (CPU/GPU/Memory) and rendering speed.",

        "feat.svg": "02. Vector Rendering",
        "feat.svg.desc": "Uses <strong class='text-green'>Hardware Acceleration</strong>. Zoom in infinitely without any blur or pixelation.",

        "feat.skip": "03. Smart Memory",
        "feat.skip.desc": "Automatically optimizes memory usage on low-end devices to prevent crashing, while running fast on high-end PCs.",

        "feat.control": "04. Total Control",
        "feat.control.desc": "Customize every click. Rebind mouse actions (Pan/Zoom), toggle transparency grids, and adjust scrolling logic.",

        "feat.design": "05. Designer Mode",
        "feat.design.desc": "Borderless window + 'Always on Top' (Ctrl+T). Perfect for pinning reference images over other creative software.",

        "feat.inspect": "06. Deep Inspection",
        "feat.inspect.desc": "Professional analysis tools: Check Color Space (P3/sRGB), Compression Quality, and full EXIF camera data.",

        "feat.repair": "07. Auto-Repair",
        "feat.repair.desc": "Smartly detects file types. Auto-fixes incorrect file extensions (e.g., a PNG saved as .jpg) with one click.",

        "feat.raw": "08. Instant RAW",
        "feat.raw.desc": "One-click Rendering for Professional RAW files (ARW/CR3). Instantly switch between Fast Preview and High-Quality Decode.",

        "feat.wall": "09. Photo Wall",
        "feat.wall.desc": "Press 'T' to turn your folder into a smooth, high-performance infinite gallery view.",

        "feat.portable": "10. Portable",
        "feat.portable.desc": "Single file (exe). No installation required. Carry your settings in a USB stick.",

        "philo.title": "Why QuickView?",
        "philo.speed.title": "Speed First",
        "philo.speed.desc": "We use the latest technology, fastest algorithms, and optimized frameworks to maximize your PC's performance.",
        "philo.privacy.title": "Privacy Native",
        "philo.privacy.desc": "100% Offline. 100% Open Source.",
        "philo.bloat.title": "Zero Bloat",
        "philo.bloat.desc": "6.xMB single-file executable. No garbage data. Fully portable support."
    },
    // Simplified Chinese
    "zh-CN": {
        "nav.performance": "极致性能",
        "nav.architecture": "核心技术",
        "nav.features": "功能亮点",
        "cta.download": "下载 v3.0.4",
        "cta.github": "查看源码",
        "hero.title": "Windows 平台<br>最快的图像查看器。",
        "hero.subtitle": "专注于速度的图片查看器。作为开源软件，其性能媲美甚至超越商用同类产品。<br>以轻量、速度、全面的格式兼容著称。专为图像工作者打造。",

        "arch.title": "核心引擎：量子流 (Quantum Flow)",
        "arch.desc": "拒绝卡顿。区别于传统软件，QuickView 采用独家的 <span class='text-blue'>防卡顿技术 (Anti-Freeze)</span>，在加载超大图片时界面依然丝般顺滑。",

        "feat.matrix": "01. 性能监控 HUD",
        "feat.matrix.desc": "按 <strong class='text-primary'>F12</strong> 开启极客面板。实时显示内存占用、显卡状态和渲染延迟，性能一目了然。",

        "feat.svg": "02. 矢量高清渲染",
        "feat.svg.desc": "采用 <strong class='text-green'>显卡硬件加速</strong> 渲染。任意放大 SVG 矢量图，边缘永远清晰锐利，绝无锯齿。",

        "feat.skip": "03. 智能内存优化",
        "feat.skip.desc": "懂你的硬件。在低配电脑上自动节省内存防止崩溃，在高配电脑上火力全开提升速度。",

        "feat.control": "04. 掌控一切",
        "feat.control.desc": "自定义你的操作习惯。重新绑定鼠标手势（平移/缩放），切换透明网格，调整循环模式。",

        "feat.design": "05. 设计师模式",
        "feat.design.desc": "无边框窗口 + “总在最前” (Ctrl+T)。置顶显示图片，作为设计参考图的神器。",

        "feat.inspect": "06. 深度检测",
        "feat.inspect.desc": "专业级信息面板。查看色彩空间 (P3/sRGB)、色度采样率、压缩质量 (Q-Factor) 及完整相机参数 (EXIF)。",

        "feat.repair": "07. 智能修复",
        "feat.repair.desc": "自动识别真实格式。一键修复错误的扩展名（例如把 PNG 误存为 JPG 的文件）。",

        "feat.raw": "08. RAW 极速渲染",
        "feat.raw.desc": "摄影师的福音。一键切换“极速预览”和“完整解码”，秒开几十MB的专业 RAW 文件 (ARW/CR3)。",

        "feat.wall": "09. 沉浸式照片墙",
        "feat.wall.desc": "按 'T' 键进入照片墙模式。以 60 帧流畅度浏览成千上万张照片。",

        "feat.portable": "10. 绿色便携",
        "feat.portable.desc": "单文件 EXE。无需安装，不写注册表。配置随身带，完美支持 USB 运行。",

        "philo.title": "为什么选择 QuickView？",
        "philo.speed.title": "速度至上",
        "philo.speed.desc": "我们采用最新的技术，最快的算法，最合理的框架来最大化您电脑的性能。",
        "philo.privacy.title": "原生隐私",
        "philo.privacy.desc": "100% 离线运行。100% 源代码开源。",
        "philo.bloat.title": "拒绝臃肿",
        "philo.bloat.desc": "6.xMB 绿色单文件程序，不产生任何垃圾数据，支持便携模式。"
    },
    // Traditional Chinese
    "zh-TW": {
        "nav.performance": "極致效能",
        "nav.architecture": "核心技術",
        "nav.features": "功能亮點",
        "cta.download": "下載 v3.0.4",
        "cta.github": "查看原始碼",
        "hero.title": "Windows 平台<br>最快的圖像檢視器。",
        "hero.subtitle": "專注於速度的圖片檢視器。作為開源軟體，其性能媲美甚至超越商用同類產品。<br>以輕量、速度、全面的格式相容著稱。專為圖像工作者打造。",
        "arch.title": "核心引擎：量子流 (Quantum Flow)",
        "arch.desc": "拒絕卡頓。區別於傳統軟體，QuickView 採用獨家的 <span class='text-blue'>防卡頓技術 (Anti-Freeze)</span>，在加載超大圖片時界面依然絲般順滑。",
        "philo.speed.title": "速度至上",
        "philo.speed.desc": "我們採用最新的技術，最快的演算法，最合理的框架來最大化您電腦的性能。",
        "philo.privacy.title": "原生隱私",
        "philo.privacy.desc": "100% 離線運行。100% 源代碼開源。",
        "philo.bloat.title": "拒絕臃腫",
        "philo.bloat.desc": "6.xMB 綠色單文件程式，不產生任何垃圾數據，支持便攜模式。"
    },
    // Japanese
    "ja": {
        "nav.performance": "パフォーマンス",
        "nav.architecture": "コア技術",
        "nav.features": "機能",
        "cta.download": "ダウンロード v3.0.4",
        "cta.github": "ソースコード",
        "hero.title": "Windows向けの<br>最速画像ビューア。",
        "hero.subtitle": "スピードに特化したプロ仕様。オープンソースでありながら、商用ソフトに匹敵する性能。<br>軽量、瞬時のレスポンス、多様なフォーマット対応。デザイナーと写真家のために。",
        "arch.title": "コアエンジン：Quantum Flow",
        "philo.speed.title": "スピード至上",
        "philo.speed.desc": "最新の技術、最速のアルゴリズム、最適化されたフレームワークを使用して、PCのパフォーマンスを最大化します。",
        "philo.privacy.title": "プライバシー",
        "philo.privacy.desc": "100％オフライン。100％オープンソース。",
        "philo.bloat.title": "肥大化なし",
        "philo.bloat.desc": "6.xMBの単一ファイル実行可能ファイル。ゴミデータなし。ポータブル完全対応。"
    },
    // Spanish
    "es": {
        "nav.performance": "Rendimiento",
        "nav.architecture": "Tecnología",
        "nav.features": "Funciones",
        "cta.download": "Descargar v3.0.4",
        "cta.github": "Código Fuente",
        "hero.title": "El visor de imágenes<br>más rápido para Windows.",
        "hero.subtitle": "Un visor de imágenes profesional centrado en la velocidad. Código abierto, rivaliza con software comercial.<br>Conocido por su ligereza, respuesta instantánea y soporte completo de formatos.",
        "arch.title": "Motor Núcleo: Quantum Flow",
        "philo.speed.title": "Velocidad Primero",
        "philo.speed.desc": "Utilizamos la última tecnología, algoritmos más rápidos y marcos optimizados para maximizar el rendimiento de su PC.",
        "philo.privacy.title": "Privacidad Nativa",
        "philo.privacy.desc": "100% Offline. 100% Código Abierto.",
        "philo.bloat.title": "Cero Bloatware",
        "philo.bloat.desc": "Ejecutable de 6.xMB. Sin archivos basura. Soporte portátil total."
    },
    // German
    "de": {
        "nav.performance": "Leistung",
        "nav.architecture": "Technik",
        "nav.features": "Funktionen",
        "cta.download": "Download v3.0.4",
        "cta.github": "Quellcode",
        "hero.title": "Der schnellste Bildbetrachter<br>für Windows.",
        "hero.subtitle": "Ein professioneller Bildbetrachter, fokussiert auf Geschwindigkeit. Open Source, konkurriert mit kommerzieller Software.<br>Bekannt für minimalen Speicherbedarf, sofortige Reaktion und umfassende Formatunterstützung.",
        "arch.title": "Kern-Engine: Quantum Flow",
        "philo.speed.title": "Geschwindigkeit",
        "philo.speed.desc": "Wir nutzen neueste Technologie und schnellste Algorithmen, um die Leistung Ihres PCs zu maximieren.",
        "philo.privacy.title": "Privatsphäre",
        "philo.privacy.desc": "100% Offline. 100% Open Source.",
        "philo.bloat.title": "Kein Ballast",
        "philo.bloat.desc": "6.xMB Einzeldatei. Keine Datenreste. Volle portable Unterstützung."
    },
    // Russian
    "ru": {
        "nav.performance": "Скорость",
        "nav.architecture": "Технологии",
        "nav.features": "Функции",
        "cta.download": "Скачать v3.0.4",
        "cta.github": "Исходный код",
        "hero.title": "Самый быстрый просмотрщик<br>изображений для Windows.",
        "hero.subtitle": "Профессиональный просмотрщик, ориентированный на скорость. Открытый код, уровень коммерческого ПО.<br>Мгновенный отклик, легкий вес и поддержка всех форматов.",
        "arch.title": "Движок: Quantum Flow",
        "philo.speed.title": "Скорость прежде всего",
        "philo.speed.desc": "Мы используем новейшие технологии и алгоритмы для максимальной производительности вашего ПК.",
        "philo.privacy.title": "Приватность",
        "philo.privacy.desc": "100% Оффлайн. 100% Открытый код.",
        "philo.bloat.title": "Без мусора",
        "philo.bloat.desc": "Один файл 6.xMB. Никакого мусора. Полная поддержка portable-режима."
    }
};

// Fallback logic to fill missing keys with English
Object.keys(translations).forEach(lang => {
    if (lang === 'en') return;
    Object.keys(translations['en']).forEach(key => {
        if (!translations[lang][key]) {
            translations[lang][key] = translations['en'][key];
        }
    });
});

let currentVersion = 'v3.0.4';
const supportedLangs = ['en', 'zh-CN', 'zh-TW', 'ja', 'es', 'de', 'ru'];

function setLanguage(lang) {
    if (!translations[lang]) lang = 'en';
    localStorage.setItem('qv_lang', lang);
    document.documentElement.lang = lang;

    const elements = document.querySelectorAll('[data-i18n]');
    elements.forEach(el => {
        const key = el.getAttribute('data-i18n');
        if (translations[lang] && translations[lang][key]) {
            el.innerHTML = translations[lang][key];
        }
    });

    const langBtn = document.getElementById('lang-btn');
    if (langBtn) {
        // Map code to Label
        const labels = {
            'en': 'English',
            'zh-CN': '简体中文',
            'zh-TW': '繁體中文',
            'ja': '日本語',
            'es': 'Español',
            'de': 'Deutsch',
            'ru': 'Русский'
        };
        langBtn.textContent = (labels[lang] || lang.toUpperCase()) + " ▾";
    }
}

function detectLanguage() {
    const saved = localStorage.getItem('qv_lang');
    if (saved && supportedLangs.includes(saved)) return saved;

    const browser = navigator.language;
    // Strict matching
    if (supportedLangs.includes(browser)) return browser;
    // Prefix matching for es-ES, de-DE etc.
    const prefix = browser.split('-')[0];
    if (supportedLangs.includes(prefix)) return prefix;

    // Fallback for Chinese variants
    if (browser.startsWith('zh')) {
        return browser.includes('TW') || browser.includes('HK') ? 'zh-TW' : 'zh-CN';
    }

    return 'en';
}

// Version Auto-update
async function fetchVersion() {
    try {
        const response = await fetch('https://api.github.com/repos/justnullname/QuickView/releases/latest');
        if (!response.ok) throw new Error('Network response was not ok');
        const data = await response.json();
        const latestVersion = data.tag_name;

        if (latestVersion && latestVersion !== currentVersion) {
            currentVersion = latestVersion;

            const badge = document.getElementById('version-badge');
            if (badge) badge.textContent = `${latestVersion} Quantum Flow Update`;

            Object.keys(translations).forEach(lang => {
                if (translations[lang]["cta.download"]) {
                    translations[lang]["cta.download"] = translations[lang]["cta.download"].replace(/v\d+\.\d+\.\d+/, latestVersion);
                }
            });

            const lang = detectLanguage();
            setLanguage(lang);
        }
    } catch (error) {
        console.log('Using default version:', currentVersion);
    }
}

document.addEventListener('DOMContentLoaded', () => {
    const lang = detectLanguage();
    setLanguage(lang);

    fetchVersion();

    // Loop through languages on click
    // Dropdown Logic
    const langBtn = document.getElementById('lang-btn');
    const langMenu = document.getElementById('lang-menu');

    // Toggle
    langBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        langMenu.classList.toggle('show');
    });

    // Selection
    const langItems = langMenu.querySelectorAll('div[data-lang]');
    langItems.forEach(item => {
        item.addEventListener('click', () => {
            const selectedLang = item.getAttribute('data-lang');
            setLanguage(selectedLang);
            langMenu.classList.remove('show');
        });
    });

    // Close on outside click
    document.addEventListener('click', () => {
        if (langMenu.classList.contains('show')) {
            langMenu.classList.remove('show');
        }
    });
});
